var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(t){i(t)}}function a(e){try{u(o["throw"](e))}catch(t){i(t)}}function u(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}u((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,i&&(s=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,i=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){u.label=n[1];break}if(6===n[0]&&u.label<s[1]){u.label=s[1],s=n;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(n);break}s[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(o){n=[6,o],i=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},HttpActionData=function(){function e(e){this.body={},this.validate(e)}return e.prototype.validate=function(e){throw new Error("需要子类实现")},e}();__reflect(HttpActionData.prototype,"HttpActionData",["IHttpActionData"]);var SQApi=function(){function e(){}return e.prototype.fetchJson=function(e,t,n){var o=this,r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.open(e.url,egret.HttpMethod.GET),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Access-Control-Allow-Origin","*");for(var i=0,s=Object.keys(e.header);i<s.length;i++){var a=s[i];r.setRequestHeader(a,e.header[a])}r.send(),r.addEventListener(egret.Event.COMPLETE,function(e){var r=e.currentTarget.response;if(!r)return void n(new SQApiError({message:"HTTP GET response is null"}));var i=JSON.parse(r);i.ok?t(i.result):n(o.getResponseError(i))},this),r.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){n(new SQApiError({message:"无法连接到服务器"}))},this)},e.prototype.postReturnJson=function(e,t,n){var o=this,r=e.url+this.buildParams(e.parameters),i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(r,egret.HttpMethod.POST);for(var s=0,a=Object.keys(e.header);s<a.length;s++){var u=a[s];i.setRequestHeader(u,e.header[u])}if(i.addEventListener(egret.Event.COMPLETE,function(e){var r=e.currentTarget.response;if(!r)return void n(new SQApiError({message:"HTTP POST response is null"}));var i=JSON.parse(r);i.ok?t(i.result):n(o.getResponseError(i))},this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){n(new SQApiError({message:"无法连接到服务器"}))},this),e.body){var c=this.buildBody(e.body);i.send(c)}else i.send()},e.prototype.getResponseError=function(e){if(e.errors){if(e.errors.length<=0)return new SQApiError({message:"服务器请求错误返回格式不对。"});var t=e.errors[0],n=t.message;return t.field&&(n=n+" ("+t.field+")"),new SQApiError({message:n,error_type:e.errors[0].error_type})}return new SQApiError({message:e.message,error_type:e.error_type})},e.prototype.buildParams=function(e){if(!e)return"";var t="?";for(var n in e)n&&(t=t+n+"="+e[n]+"&");return t=t.slice(0,-1)},e.prototype.buildBody=function(e){return JSON.stringify(e)},e}();__reflect(SQApi.prototype,"SQApi");var NoAuthorizedHeaderFactory=function(){function e(e){this.header={Accept:"application/json","Access-Control-Allow-Origin":"*","Content-Type":"application/json"}}return e.prototype.create=function(){return this.header},e}();__reflect(NoAuthorizedHeaderFactory.prototype,"NoAuthorizedHeaderFactory",["IHeaderFactory"]);var SQLayer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){for(var e=this.numChildren,n=0;e>n;n+=1){var o=this.getChildAt(n);o instanceof t&&o.onEnter()}},t.prototype.onExit=function(){for(var e=this.numChildren,n=0;e>n;n+=1){var o=this.getChildAt(n);o instanceof t&&o.onExit()}},t}(eui.Component);__reflect(SQLayer.prototype,"SQLayer");var SQScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){for(var e=this.numChildren,t=0;e>t;t+=1){var n=this.getChildAt(t);n instanceof SQLayer&&n.onEnter()}},t.prototype.onExit=function(){for(var e=this.numChildren,t=0;e>t;t+=1){var n=this.getChildAt(t);n instanceof SQLayer&&n.onExit()}},t}(eui.Component);__reflect(SQScene.prototype,"SQScene");var approveTagDatas=[{name:"有趣",normal_image:"btn_good_1@2x_png",on_image:"btn_good_1_selected@2x_png"},{name:"有意思",normal_image:"btn_good_2@2x_png",on_image:"btn_good_2_selected@2x_png"},{name:"题很棒",normal_image:"btn_good_3@2x_png",on_image:"btn_good_3_selected@2x_png"},{name:"蛮喜欢",normal_image:"btn_good_4@2x_png",on_image:"btn_good_4_selected@2x_png"}],disapproveTagDatas=[{name:"挺无聊",normal_image:"btn_bad_1@2x_png",on_image:"btn_bad_1_selected@2x_png"},{name:"没意思",normal_image:"btn_bad_2@2x_png",on_image:"btn_bad_2_selected@2x_png"},{name:"不喜欢",normal_image:"btn_bad_3@2x_png",on_image:"btn_bad_3_selected@2x_png"},{name:"枯燥",normal_image:"btn_bad_4@2x_png",on_image:"btn_bad_4_selected@2x_png"}],QuizTagModel=function(){function e(){}return e.prototype.listApproveTags=function(){return this.approveTags=approveTagDatas.map(function(e){return new Tag(e)}),this.approveTags},e.prototype.listSelectedApproveTags=function(){return this.approveTags.filter(function(e){return e.selected?e:void 0})},e.prototype.listDisapproveTags=function(){return this.disapproveTags=disapproveTagDatas.map(function(e){return new Tag(e)}),this.disapproveTags},e.prototype.listSelectedDisapproveTags=function(){return this.disapproveTags.filter(function(e){return e.selected?e:void 0})},e}();__reflect(QuizTagModel.prototype,"QuizTagModel");var Tag=function(){function e(e){this.name=e.name,this.normalImage=e.normal_image,this.onImage=e.on_image,this.selected=!1}return e}();__reflect(Tag.prototype,"Tag");var SQEventCenter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t}(egret.EventDispatcher);__reflect(SQEventCenter.prototype,"SQEventCenter");var GameOverScene=function(e){function t(t){var n=e.call(this)||this;return n.skinName="GameOverSceneUI",n.model=t,n.continueButton.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onPressContinueButton,n),n}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.setGameInformations()},t.prototype.setGameInformations=function(){this.answerCorrectInfo.setTitleText("答对题目"),this.answerCorrectInfo.setValueText(String(this.model.getAnswerCorrectAmount())),this.answerWrongInfo.setTitleText("答错题目"),this.answerWrongInfo.setValueText(String(this.model.getAnswerWrongAmount()))},t.prototype.onPressContinueButton=function(){this.goPlayingScene()},t.prototype.goPlayingScene=function(){var e=this,t=new SQLoadingLayer;t.show();var n=new QuizSceneModel;n.fetchQuestions(function(){t.hide(),SQSceneManager.sharedInstance().removeChildLayer(e),SQSceneManager.sharedInstance().replaceScene(new QuizScene(n))},function(e){t.hide()})},t}(SQScene);__reflect(GameOverScene.prototype,"GameOverScene");var GameOverSceneModel=function(){function e(e){this.answerCorrectAmount=e.answer_correct_amount,this.answerWrongAmount=e.answer_wrong_amount}return e.prototype.getAnswerCorrectAmount=function(){return this.answerCorrectAmount},e.prototype.getAnswerWrongAmount=function(){return this.answerWrongAmount},e}();__reflect(GameOverSceneModel.prototype,"GameOverSceneModel");var GameOverInfoItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="GameOverInfoItemUI",t}return __extends(t,e),t.prototype.setTitleText=function(e){this.titleLabel.text=e},t.prototype.setValueText=function(e){this.valueLabel.text=e},t}(SQLayer);__reflect(GameOverInfoItem.prototype,"GameOverInfoItem");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?o(r):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadPreloadResourceGroup()];case 1:return t.sent(),this.createLaunchGameScene(),SQSceneManager.sharedInstance().addRootStage(this),SQSceneManager.sharedInstance().pushScene(new LaunchGameScene),[4,platform.login()];case 2:return t.sent(),[4,platform.getUserInfo()];case 3:return e=t.sent(),console.log(e),[2]}})})},t.prototype.loadPreloadResourceGroup=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createLaunchGameScene=function(){var e=this.createBitmapByName("bg_tu@2x_jpg");this.addChild(e);var t=this.stage.stageWidth,n=this.stage.stageHeight;e.width=t,e.height=n},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var SQApiConfig=function(){function e(){}return e.Host="https://api-staging.shafayouxi.org",e.V1="v1",e}();__reflect(SQApiConfig.prototype,"SQApiConfig");var SQApiErrorType;!function(e){e[e.None=0]="None",e[e.UserNotFound=1]="UserNotFound"}(SQApiErrorType||(SQApiErrorType={}));var SQApiError=function(e){function t(t){var n=e.call(this)||this;return n.message=t.message,"user_not_found"===t.error_type?n.type=SQApiErrorType.UserNotFound:n.type=SQApiErrorType.None,n}return __extends(t,e),t}(Error);__reflect(SQApiError.prototype,"SQApiError");var HttpPost=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.execute=function(e,t,n){var o={url:e.url,header:e.headerFactory.create(),body:e.body};this.postReturnJson(o,function(e){t(e)},function(e){n(e)})},t}(SQApi);__reflect(HttpPost.prototype,"HttpPost",["IHttpAction"]);var AuthorizedHeaderFactory=function(e){function t(t){var n=e.call(this,t)||this;return t.access_token&&(n.header.Authorization="Bearer "+t.access_token),n}return __extends(t,e),t}(NoAuthorizedHeaderFactory);__reflect(AuthorizedHeaderFactory.prototype,"AuthorizedHeaderFactory");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var LaunchGameScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="LaunchGameSceneUI",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.addLoadGroupEvent(),RES.loadGroup("answer")},t.prototype.addLoadGroupEvent=function(){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGroupProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},t.prototype.removeLoadGroupEvent=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGroupProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},t.prototype.onGroupLoadComplete=function(e){this.removeLoadGroupEvent(),this.goQuizScene()},t.prototype.goQuizScene=function(){var e=this,t=new QuizSceneModel;this.descriptionLabel.text="正在请求数据...",t.fetchQuestions(function(){SQSceneManager.sharedInstance().replaceScene(new QuizScene(t))},function(){e.goQuizScene()})},t.prototype.onGroupLoadError=function(e){console.log("load resource error",e)},t.prototype.onGroupProgress=function(e){this.descriptionLabel.text="资源加载中..."+Math.floor(e.itemsLoaded/e.itemsTotal*100)+"%"},t.prototype.onItemLoadError=function(e){throw new Error(e.resItem.url+"加载失败")},t}(SQScene);__reflect(LaunchGameScene.prototype,"LaunchGameScene");var QuizScene=function(e){function t(t){var n=e.call(this)||this;return n.skinName="QuizSceneUI",n.model=t,n}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.showQuestion(this.model.getQuestionAtIndex(this.model.currentQuestionAmount)),this.bottomToolbar.setItems(this.model.listBottomToolbarItems()),this.setupCallbacks()},t.prototype.setupCallbacks=function(){this.navigationBar.pressLeftButtonHandler=this.quitGame.bind(this),this.dashboard.pressAnswerHandler=this.chooseAnswer.bind(this),this.quizFinishedLayer.pressApproveButtonHandler=this.approveQuiz.bind(this),this.quizFinishedLayer.pressDisapproveButtonHandler=this.disapproveQuiz.bind(this),this.quizFinishedLayer.postQuestionTagsHandler=this.postQuestionTags.bind(this),this.quizFinishedLayer.pressContinueHandler=this.next.bind(this),this.questionLayer.timesUpHandler=this.timesUp.bind(this)},t.prototype.fetchQuestions=function(){var e=this,t=new SQLoadingLayer;t.show(),this.model.fetchQuestions(function(n){t.hide(),e.showQuestion(e.model.getQuestionAtIndex(e.model.currentQuestionAmount))},function(e){t.hide()})},t.prototype.showQuestion=function(e){this.questionLayer.setCategory(e.category),this.questionLayer.setQuestionText(e.text),this.questionLayer.startQuizTimer(20),this.questionLayer.setProgressLabel(this.model.currentQuestionAmount+1+"/"+this.model.totalQuestionAmount),this.dashboard.setAnswers(e.answers),this.model.countQuestionById(e.id,function(){console.log("问题计数成功")},function(e){console.log("问题计数失败"+e.message)})},t.prototype.timesUp=function(){this.dashboard.disableAllButtons(),this.questionLayer.showAnswerTimesUpAnimation(),this.postAnswer("",100)},t.prototype.chooseAnswer=function(e){var t=this;this.questionLayer.stopQuizTimer(function(n){var o=new ButtonStateEvent(ButtonStateEvent.ANSWER_CORRECT);if(SQEventCenter.sharedInstance().dispatchEvent(o),t.model.setCurrentAnswer(e),e.isCorrect)t.questionLayer.showAnswerCorrectAnimation(),t.model.addAnswerCorrectAmount();else{var r=new ButtonStateEvent(ButtonStateEvent.ANSWER_WRONG);SQEventCenter.sharedInstance().dispatchEvent(r),t.questionLayer.showAnswerWrongAnimation(),t.model.addAnswerWrongAmount()}t.postAnswer(e.name,n)})},t.prototype.postAnswer=function(e,t){var n=this,o=this.model.getQuestionAtIndex(this.model.currentQuestionAmount),r={question_id:o.id,answer_text:e,duration_seconds:t};this.model.postAnswer(r,function(){n.showQuizFinishedLayer(o)},function(e){console.log("发送回答失败")})},t.prototype.showQuizFinishedLayer=function(e){this.quizFinishedLayer.setQuestion(e),this.dashboardTweenGroup.play(0)},t.prototype.quitGame=function(){console.log("quitGame........")},t.prototype.approveQuiz=function(e){var t={action:"up",question_id:e.id,question_token:e.token};this.model.voteQuestionById(t,function(){},function(e){})},t.prototype.disapproveQuiz=function(e){var t={action:"down",question_id:e.id,question_token:e.token};this.model.voteQuestionById(t,function(){},function(e){})},t.prototype.postQuestionTags=function(e,t){var n={question_id:e.id,tag:t[0].name};this.model.postQuestionTags(n,function(e){console.log("postQuestionTags success #####",e)},function(e){console.log("postQuestionTags failed #####",e.message)})},t.prototype.next=function(){if(!this.model.getCurrentAnswer())return void SQSceneManager.sharedInstance().addChildLayer(new GameOverScene(this.createGameOverModel()));if(!this.model.getCurrentAnswer().isCorrect)return void SQSceneManager.sharedInstance().addChildLayer(new GameOverScene(this.createGameOverModel()));this.model.currentQuestionAmount+=1;var e=new ButtonStateEvent(ButtonStateEvent.ANSWER_RESET);return SQEventCenter.sharedInstance().dispatchEvent(e),this.dashboardGroup.x=0,this.model.currentQuestionAmount===this.model.totalQuestionAmount?(this.model.reset(),void this.fetchQuestions()):void this.showQuestion(this.model.getQuestionAtIndex(this.model.currentQuestionAmount))},t.prototype.createGameOverModel=function(){var e={answer_correct_amount:this.model.getAnswerCorrectAmount(),answer_wrong_amount:this.model.getAnswerWrongAmount()};return new GameOverSceneModel(e)},t}(SQScene);__reflect(QuizScene.prototype,"QuizScene");var Answer=function(){function e(e){this.name=e.name,this.isCorrect=e.correct,this.index=e.index}return e}();__reflect(Answer.prototype,"Answer");var Question=function(){function e(e){this.category=e.category,this.id=e.id,this.language=e.language,this.text=e.text,this.token=e.question_token,this.answers=this.createAnswers(e.options)}return e.prototype.createAnswers=function(e){return e.map(function(e,t){var n=e;return n.index=t,new Answer(n)})},e}();__reflect(Question.prototype,"Question");var QuizSceneModel=function(){function e(){this.currentQuestionAmount=0,this.httpPost=new HttpPost,this.answerCorrectAmount=0,this.answerWrongAmount=0}return e.prototype.setCurrentAnswer=function(e){this.currentAnswer=e},e.prototype.getCurrentAnswer=function(){return this.currentAnswer},e.prototype.addAnswerCorrectAmount=function(){this.answerCorrectAmount+=1},e.prototype.getAnswerCorrectAmount=function(){return this.answerCorrectAmount},e.prototype.addAnswerWrongAmount=function(){this.answerWrongAmount+=1},e.prototype.getAnswerWrongAmount=function(){return this.answerWrongAmount},e.prototype.reset=function(){this.currentQuestionAmount=0,this.questions=[]},e.prototype.getQuestionAtIndex=function(e){return this.questions.length<=e?void 0:this.questions[e]},e.prototype.fetchQuestions=function(e,t){var n=this,o=new FetchQuestionsData({access_token:UserModel.sharedInstance().attribute.token,user_id:UserModel.sharedInstance().attribute.id});this.httpPost.execute(o,function(t){n.questions=n.createQuestions(t.questions),n.totalQuestionAmount=n.questions.length,e(n.questions)},function(e){t(e)})},e.prototype.postAnswer=function(e,t,n){var o=new PostAnswerData({user_id:UserModel.sharedInstance().attribute.id,quiz_token:UserModel.sharedInstance().attribute.quizToken,question_id:e.question_id,duration_seconds:e.duration_seconds,answer:e.answer_text});this.httpPost.execute(o,function(e){t()},function(e){n(e)})},e.prototype.countQuestionById=function(e,t,n){var o=new CountQuestionData({user_id:UserModel.sharedInstance().attribute.id,question_id:e});this.httpPost.execute(o,function(e){t()},function(e){n(e)})},e.prototype.voteQuestionById=function(e,t,n){var o=new VoteQuestionData({user_id:UserModel.sharedInstance().attribute.id,token:e.question_token,question_id:e.question_id,action:e.action});this.httpPost.execute(o,function(e){t(e)},function(e){n(e)})},e.prototype.postQuestionTags=function(e,t,n){var o=new PostTagData({user_id:UserModel.sharedInstance().attribute.id,question_id:e.question_id,tag:e.tag});this.httpPost.execute(o,function(e){t(e)},function(e){n(e)})},e.prototype.listBottomToolbarItems=function(){return[{icon:"img_bomb@2x_png",title:"炸弹",description:"去掉两个错误答案"},{icon:"img_opportunity@2x_png",title:"机会",description:"多一次机会"},{icon:"img_jump_over@2x_png",title:"跳过",description:"跳过这一题"}]},e.prototype.createQuestions=function(e){return e.map(function(e){return new Question(e)})},e}();__reflect(QuizSceneModel.prototype,"QuizSceneModel");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var CountQuestionData=function(e){function t(t){var n=e.call(this,t)||this;return n.url=SQApiConfig.Host+"/"+SQApiConfig.V1+"/count/"+t.question_id,n.headerFactory=new NoAuthorizedHeaderFactory({}),n.body.user_id=t.user_id,n}return __extends(t,e),t.prototype.validate=function(e){return this.isLegal=!1,e.user_id?void(this.isLegal=!0):void(this.validateMessage="没有找到用户id")},t}(HttpActionData);__reflect(CountQuestionData.prototype,"CountQuestionData");var FetchQuestionsData=function(e){function t(t){var n=e.call(this,t)||this;return n.url=SQApiConfig.Host+"/"+SQApiConfig.V1+"/quiz/game/marathon",n.headerFactory=new AuthorizedHeaderFactory({access_token:t.access_token}),n.body.user_id=t.user_id,n}return __extends(t,e),t.prototype.validate=function(e){return this.isLegal=!1,e.access_token?e.user_id?void(this.isLegal=!0):void(this.validateMessage="请提供用户id"):void(this.validateMessage="请传入access_token")},t}(HttpActionData);__reflect(FetchQuestionsData.prototype,"FetchQuestionsData");var PostAnswerData=function(e){function t(t){var n=e.call(this,t)||this;return n.url=SQApiConfig.Host+"/"+SQApiConfig.V1+"/quiz/answer",n.headerFactory=new AuthorizedHeaderFactory({access_token:t.access_token}),n.body.user_id=t.user_id,n.body.question_id=t.question_id,n.body.quiz_token=t.quiz_token,n.body.duration_seconds=t.duration_seconds,n.body.answer=t.answer,n}return __extends(t,e),t.prototype.validate=function(e){this.isLegal=!0},t}(HttpActionData);__reflect(PostAnswerData.prototype,"PostAnswerData");var PostTagData=function(e){function t(t){var n=e.call(this,t)||this;return n.url=SQApiConfig.Host+"/"+SQApiConfig.V1+"/tag/"+t.question_id,n.headerFactory=new AuthorizedHeaderFactory({access_token:t.access_token}),n.body.user_id=t.user_id,n.body.tag=t.tag,n}return __extends(t,e),t.prototype.validate=function(e){return this.isLegal=!1,e.user_id?e.tag?void(this.isLegal=!0):void(this.validateMessage="请提供tag"):void(this.validateMessage="请提供用户的id")},t}(HttpActionData);__reflect(PostTagData.prototype,"PostTagData");var VoteQuestionData=function(e){function t(t){var n=e.call(this,t)||this;return n.url=SQApiConfig.Host+"/"+SQApiConfig.V1+"/vote/"+t.question_id,n.headerFactory=new NoAuthorizedHeaderFactory({}),n.body.user_id=t.user_id,n.body.action=t.action,n.body.token=t.token,console.log(t),n}return __extends(t,e),t.prototype.validate=function(e){return this.isLegal=!0,e.user_id?e.action?e.token?e.question_id?void(this.validateMessage="请提供问题id"):void(this.isLegal=!0):void(this.validateMessage="请提供有效问题token"):void(this.validateMessage="没有提供投票行为"):void(this.validateMessage="没有可用用户id")},t}(HttpActionData);__reflect(VoteQuestionData.prototype,"VoteQuestionData");var QuestionLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="QuestionLayerUI",t}return __extends(t,e),t.prototype.showAnswerTimesUpAnimation=function(){var e=this,t=AnimationFactory.create("answer_times_up_animation_json","answer_times_up_animation_png");this.animationContainer.addChild(t),this.animationContainer.layout=this.createAnimationContainerLayout(),t.gotoAndPlay("play",0),t.addEventListener(egret.MovieClipEvent.COMPLETE,function(){e.animationContainer.removeChild(t)},this)},t.prototype.showAnswerCorrectAnimation=function(){var e=this,t=AnimationFactory.create("answer_correct_animation_json","answer_correct_animation_png");this.animationContainer.addChild(t),this.animationContainer.layout=this.createAnimationContainerLayout(),t.gotoAndPlay("play",0),t.addEventListener(egret.MovieClipEvent.COMPLETE,function(){e.animationContainer.removeChild(t)},this)},t.prototype.showAnswerWrongAnimation=function(){var e=this,t=AnimationFactory.create("answer_wrong_animation_json","answer_wrong_animation_png");this.animationContainer.addChild(t),this.animationContainer.layout=this.createAnimationContainerLayout(),t.gotoAndPlay("play",0),t.addEventListener(egret.MovieClipEvent.COMPLETE,function(){e.animationContainer.removeChild(t)},this)},t.prototype.createAnimationContainerLayout=function(){var e=new eui.HorizontalLayout;return e.gap=0,e.horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e},t.prototype.setCategory=function(e){this.categoryLabel.text=e},t.prototype.setProgressLabel=function(e){this.progressLabel.text=e},t.prototype.startQuizTimer=function(e){this.timer||(this.initialTime=e,this.remainTime=e,this.timer=new egret.Timer(1e3,e),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerCalled,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerCompleted,this),this.timeLabel.text=e+'"',this.timer.start())},t.prototype.stopQuizTimer=function(e){e(this.initialTime-this.remainTime),this.stopTimer()},t.prototype.setQuestionText=function(e){this.questionLabel.text=e},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.animationContainer=new eui.Group,this.animationContainer.width=this.width,this.animationContainer.height=this.height,this.animationContainer.y=-140,this.addChild(this.animationContainer)},t.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerCalled,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerCompleted,this),this.timer=void 0)},t.prototype.timerCalled=function(){this.remainTime-=1,this.timeLabel.text=this.remainTime+'"'},t.prototype.timerCompleted=function(){this.stopTimer(),this.timesUpHandler()},t}(SQLayer);__reflect(QuestionLayer.prototype,"QuestionLayer");var QuizDashboard=function(e){function t(){var t=e.call(this)||this;return t.skinName="QuizDashboardUI",t.answerOne.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressAnswerOne,t),t.answerTwo.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressAnswerTwo,t),t.answerThree.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressAnswerThree,t),t.answerFour.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressAnswerFour,t),t}return __extends(t,e),t.prototype.setAnswers=function(e){this.answers=e,this.enableAllButtons(),this.answerOne.setAnswer(e[0]),this.answerTwo.setAnswer(e[1]),this.answerThree.setAnswer(e[2]),this.answerFour.setAnswer(e[3])},t.prototype.disableAllButtons=function(){this.answerOne.enabled=!1,this.answerTwo.enabled=!1,this.answerThree.enabled=!1,this.answerFour.enabled=!1},t.prototype.onPressAnswerOne=function(){this.disableAllButtons(),this.pressAnswerHandler&&this.pressAnswerHandler(this.answers[0])},t.prototype.onPressAnswerTwo=function(){this.disableAllButtons(),this.pressAnswerHandler&&this.pressAnswerHandler(this.answers[1])},t.prototype.onPressAnswerThree=function(){this.disableAllButtons(),this.pressAnswerHandler&&this.pressAnswerHandler(this.answers[2])},t.prototype.onPressAnswerFour=function(){this.disableAllButtons(),this.pressAnswerHandler&&this.pressAnswerHandler(this.answers[3])},t.prototype.enableAllButtons=function(){this.answerOne.enabled=!0,this.answerTwo.enabled=!0,this.answerThree.enabled=!0,this.answerFour.enabled=!0},t}(SQLayer);__reflect(QuizDashboard.prototype,"QuizDashboard");var QuizDashboardButton=function(e){function t(){var t=e.call(this)||this;return t.skinName="QuizDashboardButtonUI",t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onTapBegin,t),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.onTapReleaseOutside,t),t.addEventListener(egret.TouchEvent.TOUCH_END,t.onTappEnd,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTapped,t),SQEventCenter.sharedInstance().addEventListener(ButtonStateEvent.ANSWER_RESET,t.reset,t),t}return __extends(t,e),t.prototype.setAnswer=function(e){this.answer=e,this.setTitle(e.name),SQEventCenter.sharedInstance().removeEventListener(ButtonStateEvent.ANSWER_CORRECT,this.showCorrectState,this),SQEventCenter.sharedInstance().addEventListener(ButtonStateEvent.ANSWER_CORRECT,this.showCorrectState,this)},t.prototype.showCorrectState=function(){this.answer.isCorrect&&(this.currentState="correct")},t.prototype.showWrongState=function(){this.currentState="wrong"},t.prototype.reset=function(){this.currentState="up",SQEventCenter.sharedInstance().removeEventListener(ButtonStateEvent.ANSWER_WRONG,this.showWrongState,this)},t.prototype.setTitle=function(e){this.titleLabel.text=e},t.prototype.onTapped=function(){SQEventCenter.sharedInstance().addEventListener(ButtonStateEvent.ANSWER_WRONG,this.showWrongState,this)},t.prototype.onTapBegin=function(){this.titleLabel.visible=!1},t.prototype.onTapReleaseOutside=function(){this.titleLabel.visible=!0},t.prototype.onTappEnd=function(){this.titleLabel.visible=!0},t}(eui.Button);__reflect(QuizDashboardButton.prototype,"QuizDashboardButton");var QuizFinishedLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="QuizFinishedLayerUI",t.approveButton.addEventListener(egret.Event.CHANGE,t.onApproveChanged,t),t.disapproveButton.addEventListener(egret.Event.CHANGE,t.onDisapproveChanged,t),t.continueButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressContinueButton,t),t.tagModel=new QuizTagModel,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.tagList.itemRenderer=QuizTagItem;new eui.RadioButton},t.prototype.setQuestion=function(e){this.question=e},t.prototype.onApproveChanged=function(e){this.showApproveTags(this.approveButton.selected),this.disapproveButton.selected=!1},t.prototype.showApproveTags=function(e){this.tagList.dataProvider=new eui.ArrayCollection(e?this.tagModel.listApproveTags():[])},t.prototype.onDisapproveChanged=function(e){this.showDisapproveTags(this.disapproveButton.selected),this.approveButton.selected=!1},t.prototype.showDisapproveTags=function(e){this.tagList.dataProvider=new eui.ArrayCollection(e?this.tagModel.listDisapproveTags():[])},t.prototype.onPressContinueButton=function(){this.approveButton.selected?(this.pressApproveButtonHandler(this.question),this.postQuestionTagsHandler(this.question,this.tagModel.listSelectedApproveTags())):this.disapproveButton.selected&&(this.pressDisapproveButtonHandler(this.question),this.postQuestionTagsHandler(this.question,this.tagModel.listSelectedDisapproveTags())),this.reset(),this.pressContinueHandler&&this.pressContinueHandler()
},t.prototype.reset=function(){this.approveButton.selected=!1,this.showApproveTags(!1),this.disapproveButton.selected=!1,this.showDisapproveTags(!1)},t}(SQLayer);__reflect(QuizFinishedLayer.prototype,"QuizFinishedLayer");var QuizSceneBottomToolbar=function(e){function t(){var t=e.call(this)||this;return t.skinName="QuizSceneBottomToolbarUI",t.bombButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressBombButton,t),t.chanceButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressChanceButton,t),t.skipButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressSkipButton,t),t}return __extends(t,e),t.prototype.setItems=function(e){if(3===e.length){var t=e[0];this.bombButton.setIcon(t.icon),this.bombButton.setTitle(t.title),this.bombButton.setDescription(t.description);var n=e[1];this.chanceButton.setIcon(n.icon),this.chanceButton.setTitle(n.title),this.chanceButton.setDescription(n.description);var o=e[2];this.skipButton.setIcon(o.icon),this.skipButton.setTitle(o.title),this.skipButton.setDescription(o.description)}},t.prototype.onPressBombButton=function(){},t.prototype.onPressChanceButton=function(){},t.prototype.onPressSkipButton=function(){},t}(SQLayer);__reflect(QuizSceneBottomToolbar.prototype,"QuizSceneBottomToolbar");var QuizSceneBottomToolbarItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="QuizSceneBottomToolbarItemUI",t}return __extends(t,e),t.prototype.setIcon=function(e){this.icon.source=e},t.prototype.setTitle=function(e){this.titleLabel.text=e},t.prototype.setDescription=function(e){this.descriptionLabel.text=e},t}(SQLayer);__reflect(QuizSceneBottomToolbarItem.prototype,"QuizSceneBottomToolbarItem");var QuizTagItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="QuizTagItemUI",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTapped,t),t}return __extends(t,e),t.prototype.dataChanged=function(){this.image.source=this.data.normalImage},t.prototype.onTapped=function(){this.data.selected=!this.data.selected,this.image.source=this.data.selected?this.data.onImage:this.data.normalImage},t}(eui.ItemRenderer);__reflect(QuizTagItem.prototype,"QuizTagItem");var UserAttribute=function(){function e(e){this.id="6301af78-a2d5-4f93-b6e2-4e54e537ec9b",this.token="503dc3c3-cd84-4b10-ab97-c4ae664808f3",this.quizToken="cb725ad6-9e98-48f1-a20a-db95b4c2ac49"}return e}();__reflect(UserAttribute.prototype,"UserAttribute",["IAttribute"]);var UserModel=function(){function e(){this.attribute=new UserAttribute({})}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e}();__reflect(UserModel.prototype,"UserModel");var AnimationFactory=function(){function e(){}return e.create=function(e,t){var n=RES.getRes(e),o=RES.getRes(t),r=new egret.MovieClipDataFactory(n,o);return new egret.MovieClip(r.generateMovieClipData("animation"))},e}();__reflect(AnimationFactory.prototype,"AnimationFactory");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,o){function r(e){t.call(o,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(o))}var s=this;"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(o,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(o,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var SQPopupLayer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(SQLayer);__reflect(SQPopupLayer.prototype,"SQPopupLayer");var ButtonStateEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.ANSWER_CORRECT="event.button.state.answer.correct",t.ANSWER_WRONG="event.button.state.answer.wrong",t.ANSWER_RESET="event.button.state.answer.reset",t}(egret.Event);__reflect(ButtonStateEvent.prototype,"ButtonStateEvent");var SQSceneManager=function(e){function t(){var t=e.call(this)||this;return t.sceneStack=new eui.ViewStack,t.scenes=[],t}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.addRootStage=function(e){this.rootStage=e,this.rootStage.addChild(this.sceneStack)},t.prototype.addChildLayer=function(e){if(!e)throw new Error("无法添加不存在的layer");this.rootStage.addChild(e),e.onEnter()},t.prototype.removeChildLayer=function(e){if(!e)throw new Error("无法移出不存在的scene");e.parent&&(e.onExit(),this.rootStage.removeChild(e),e=void 0)},t.prototype.pushScene=function(e){if(!e)throw new Error("你不能push一个不存在的scene");this.sceneStack.addChild(e),e.onEnter(),this.scenes.push(e),this.sceneStack.selectedIndex=this.sceneStack.length-1},t.prototype.popScene=function(){if(1<=this.scenes.length){var e=this.scenes.pop();e.onExit();var t=this.sceneStack.removeChild(e);this.sceneStack.selectedIndex=this.sceneStack.length-1,this.sceneStack.selectedIndex<0&&(this.sceneStack.selectedIndex=0),t=void 0}},t.prototype.replaceScene=function(e){if(!e)throw new Error("你不能replace一个不存在的scene");this.popScene(),this.pushScene(e)},t.instance=void 0,t}(egret.DisplayObjectContainer);__reflect(SQSceneManager.prototype,"SQSceneManager");var NavigationBar=function(e){function t(){var t=e.call(this)||this;return t.skinName="NavigationBarUI",t.leftButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressLeftButton,t),t}return __extends(t,e),t.prototype.onPressLeftButton=function(){this.pressLeftButtonHandler&&this.pressLeftButtonHandler()},t}(SQLayer);__reflect(NavigationBar.prototype,"NavigationBar");var PureTextButton=function(e){function t(){var t=e.call(this)||this;return t.skinName="PureTextButtonUI",t}return __extends(t,e),t}(SQLayer);__reflect(PureTextButton.prototype,"PureTextButton");var SQLoadingLayer=function(e){function t(){var t=e.call(this)||this;t.skinName="LoadingLayerUI";var n=RES.getRes("loading_animation_json"),o=RES.getRes("loading_animation_png"),r=new egret.MovieClipDataFactory(n,o);return t.loadingAnimation=new egret.MovieClip(r.generateMovieClipData("loading_animation")),t.addChild(t.loadingAnimation),t.loadingAnimation.x=(t.width-t.loadingAnimation.width)/2,t.loadingAnimation.y=(t.height-t.loadingAnimation.height)/2,t.loadingAnimation.addEventListener(egret.MovieClipEvent.COMPLETE,function(){t.loadingAnimation.gotoAndPlay("play",0)},t),t}return __extends(t,e),t.prototype.show=function(){this.loadingAnimation.gotoAndPlay("play",0),SQSceneManager.sharedInstance().addChildLayer(this)},t.prototype.hide=function(){this.loadingAnimation.gotoAndStop(0),this.removeChild(this.loadingAnimation),this.loadingAnimation=void 0,SQSceneManager.sharedInstance().removeChildLayer(this)},t}(SQLayer);__reflect(SQLoadingLayer.prototype,"SQLoadingLayer");var TransparentLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="TransparentLayerUI",t}return __extends(t,e),t}(SQLayer);__reflect(TransparentLayer.prototype,"TransparentLayer");